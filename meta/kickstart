#!/usr/bin/env bash

BOXEN_DIR=/opt/boxen

echo "[ -f $BOXEN_DIR/env.sh ] && source $BOXEN_DIR/env.sh" > ~/.profile

echo 'Checking for pending software updates'
softwareupdate -i -a

echo 'Checking for Xcode command line tools'
xcode-select -p &>/dev/null
if [ "$?" != "0" ] ; then
    echo 'Please follow the prompt to install Xcode command line tools'
    xcode-select --install &>/dev/null
    while true ; do
        sleep 5
        xcode-select -p &>/dev/null && break
    done
fi

set -e

[[ -e $BOXEN_DIR ]] || sudo mkdir -p $BOXEN_DIR
[[ "$(stat --format="%U:%G" $BOXEN_DIR)" == "${USER}:staff" ]] ||  sudo chown ${USER}:staff $BOXEN_DIR
[[ -e $BOXEN_DIR/repo/README.md ]] || git clone git://github.com/halyard/halyard $BOXEN_DIR/repo

caffeinate -di $BOXEN_DIR/repo/script/boxen

